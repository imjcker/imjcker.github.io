---
layout: post
title: 接口平台的反思与发展
category: inmgr
tags: inmgr api
bg: inmgr.png
---



### 前言

接口平台发展至今已3年余，从柠檬科技到中天智慧PDI，再到如今的亿字节，接口平台qps从每个节点500到目前的1500，实现了翻倍的成果，服务稳定性从每周一挂到目前的长期稳定运行，统一接口管理平台走过了一段平常但不平凡的演进之路。而今统一接口管理平台独立出大数据平台，以独立产品为出发点，承载着艰巨的任务，为每天百万级的请求提供稳定高质量的服务是接口平台的首要目标，其它功能的完善也必不可少。以下是统一接口平台开发维护人员对接口平台的一些想法。



### 1.接口管理

**现存问题**：

接口管理混乱，文档说明不全。不负责该接口的人不知道接口作用，也不知道系统有哪些接口可供其它系统的新需求使用。

**解决方案**：

1. 健全文档管理，比如文档上传下载，文档检索等。

2. 接口按行业领域分类，设置接口功能关键字如下图

   ![接口行业领域分类](/assets/接口行业领域分类.png)



### 2.接口定制化

**现存问题**：

现有接口平台接口调用结果缺少结果字段定制化返回功能，都是直接返回上游数据厂商的原始数据，很多数据存在安全问题。比如：一个提供企业法人信息查询的接口是不应该返回企业的其它相关信息。

**解决方案**：

接口平台的发展目标不是成为“**数据源中间商**”，而是要成为高质量可定制的数据源服务提供商，在完善**接口管理**的基础上，接口平台应形成自己独有的接口业务模型，做到“要什么给什么，不该给的坚决不给”，以达到提高服务质量，杜绝法律风险的目的。



### 3.UI的设计

**现存问题**：

接口平台UI实在是太朴实无华。

**解决方案**：

除了要有客户需要的功能外，好的产品首先是要给人眼前一亮的视觉冲击，漂亮的UI，简便的操作，是吸引客户的先决条件。后台和架构工程师的艺术细胞实在不敢恭维，建议公司引进产品人员、UI设计人员等，重新设计接口平台UI，至少应该与风控系统保持一致的UI风格。



### 4.差错处理系统

**现存问题**：

现在的状况是：客户系统出错，联系行内业务，业务人员联系自有系统IT人员排查问题，IT人员通知接口平台DevOps排查接口问题。整个流程耗时费力。

**解决方案**：

接口平台建立自己的差错处理系统，监控接口业务层面的异常信息，形成自己的异常处理规则，发送报警信息到该服务指定的业务负责人。具体发送渠道应包含：短信、微信、邮件等。

与此同时完善接口平台权限控制建设，设立业务员账号，IT人员账号，管理员等权限角色；增加操作记录功能，记录操作人员在系统中的操作。

![差错处理流程图](/assets/差错处理流程图.png)

### 5.完善监控体系

**现存问题**：

接口平台目前为止没有一套完善的服务监控体系，系统出错时难以排查问题症结所在。

另外，现在的服务异常报警依托于天府银行自有的系统，接口平台没有自主的报警系统。

**解决方案**：

系统监控，包括硬件和中间件等如：服务器硬盘容量、CPU、JVM、服务状况，业务监控等。

系统方面

> 引入系统监控解决方案，追踪业务调用链路，监控系统实时性能和资源状况。考虑引入 zipkin、skywalking、pinPoint等开源组件，分析系统服务耗时，系统高峰期、用户分析。

业务方面

> 监控业务状况，分析汇总业务失败原因，发送报警，使业务人员能及时响应，达到提高服务质量的目的。



### 6.数据源对接

**现存问题**：

接口平台对接数据源没有一个完善可视化可追踪的流程跟踪。

**解决方案**：

建立一套完整的开发对接流程。

![数据源接入流程图](/assets/数据源接入流程图.png)

### 7.其它完善

1. 随着系统服务功能增多，目前暴露出一个问题，任务调度目前还是单节点运行，建议引进分布式任务调度解决方案如：改善现有quartz，引进Elastic-job等组件
2. 服务调整，亿字节版本去除 zuul-web-service，合并web-front到web-backend服务，或者独立部署前端到nginx服务。
3. 服务间调用日益增长，服务间数据传递出现结构不统一问题，是否考虑独立pojo公共包；完善代码规范如：接口、方法、变量命名等；
4. 规范版本控制，接口平台代码开发还没有版本控制概念。



### 8.功能借鉴

闭门造车盲目开发是做好产品的大忌，借鉴好的先例和成功的经验必不可少。



### 9.学习和提升

接口平台全体人员应做到与时俱进，不断学习提高个人能力，三人行必有我师，知识和经验的分享能帮助大家在学习的道路上少走弯路。有必要定期举行知识分享和讨论会议，共同学习进步。



## 领域设计

接口平台接口领域设计相关文档

### 引言

随着接口平台中接口的不断增加，接口平台暴露出一些问题：1）维护人员不知道系统中有哪些可以提供某某功能的接口。为实现接口平台的可持续发展，简化接口管理维护成本，故此迫切需要一个能快速定位接口分类，找到接口的这么一个功能。

### 需求概述

首先，需要有一个领域分类管理的功能，能够管理系统中的所有分类包括（增删改查）。其次，要有一个“API市场”的功能页面，具体展示领域分类和一些热门的接口。点击具体分类能快速查看该分类下的所有接口；另外能够提供一个从其他不同维度探索接口的界面，维度有：时间、价格、关键字、来源等等...

### 系统功能需求

| 功能             | 描述                                                         | 备注 |
| ---------------- | ------------------------------------------------------------ | ---- |
| 领域分类管理     | 维护一个接口平台特有的领域分类                               |      |
| 接口领域分类设置 | 创建接口时需选择领域分类，接口创建/编辑成功后在api_category_relation中维护分类和接口的对应关系 |      |
| 接口市场         | 从不同维度探索接口的页面                                     |      |
|                  |                                                              |      |

#### 接口设计

1. 领域分类的crud

   维护系统中的领域分类，包括增删查改

   > 1. 增：新建领域分类，确保领域名称唯一性。
   > 2. 删：删除领域分类，删除前校验该分类下是否存在接口，不存在则删除，否则提示信息。
   > 3. 查：1）页面分页查询。
   > 4. 改：跟新领域分类信息，校验唯一性。

2. 根据领域探索接口

   根据领域探索接口

   > 1. 查询系统所有领域分类或者热门分类，页面展示用
   > 2. 根据领域分类ID探索改领域的接口，页面点击领域分类链接，查询该领域的所有接口
   > 3. 展示

3. 其他

   其他接口

   > 1. 维护接口icon，增删查改，上传下载
   > 2. 实时替换



#### 数据字典

1. 领域分类表 api_category

   | 字段        | 含义     | 类型    | 长度 | 主键 | 默认值 |
   | ----------- | -------- | ------- | ---- | ---- | ------ |
   | id          | ID自增   | int     | 11   | 是   |        |
   | name        | 分类名称 | varchar | 64   |      | Null   |
   | description | 描述     | varchar | 128  |      | Null   |
   |             |          |         |      |      |        |

2. 接口领域关联表 api_category_relation

   | 字段     | 含义           | 类型 | 长度 | 主键 | 默认值 |
   | -------- | -------------- | ---- | ---- | ---- | ------ |
   | id       | ID自增         | int  | 11   | 是   |        |
   | class_id | 接口所属领域ID | int  | 11   |      |        |
   | api_id   | 接口ID         | int  | 11   |      |        |

   

## 详细设计

### 功能页面

#### 页面1-API领域分类主界面

| 功能点      | 位置         | 说明                                                         |
| ----------- | ------------ | ------------------------------------------------------------ |
| API探索     | top          | 主页面提供API探索功能，根据输入关键字展示接口                |
| 领域分类    | middle-left  | 展示常用的领域分类如：金融商业、生活服务、交通地理、吃喝玩乐... |
| 轮播展示区  | middle-right | 展示一些解决方案、服务特色等图片信息                         |
| 常用热门API | bottom       | 卡片方式展示热门API包括：名称、简介、价格、调用次数等指标    |

![1](/assets/inmgr/1.png)

#### 页面2-API市场

| 功能点                 | 位置   | 说明                                                         |
| ---------------------- | ------ | ------------------------------------------------------------ |
| 探索框                 | top    | 支持通过名称、分类等关键字探索API                            |
| 功能分类               | middle | 展示所有分类作为筛选条件                                     |
| 其他维度分类及探索条件 | middle | 展示其他筛选条件如：收费类型、API来源、付费方式、排序方式... |
| API列表                | bottom | 卡片方式展示根据筛选条件查询到的API                          |

# ![2](/assets/inmgr/2.png)

#### 页面3-API详情

这个页面类似当前接口平台系统中的接口文档页面。

| 功能点          | 位置   | 说明                                                |
| --------------- | ------ | --------------------------------------------------- |
| API概要         | top    | 展示API的名称、简介、来源、价格、购买链接等         |
| 其他信息tab页面 | middle |                                                     |
| Tab1            |        | 产品说明                                            |
| Tab2            |        | API文档（请求方式、参数、返回值、错误码表等的说明） |
| Tab3            |        | 代码示例                                            |
| Tab4            |        | 错误参照码表                                        |
| Tab5            |        | 其他相关                                            |
| 相关API         | bottom | 与此页面的API相关的API展示。                        |

![3](/assets/inmgr/3.png)





## 参考

### showapi

URL：[showapi](https://www.showapi.com/api/apiList)

**首页**

![1](/assets/inmgr/showapi-1.png)

**接口详情**

![2](/assets/inmgr/showapi-2.png)



### juhe

URL: [juhe](https://www.juhe.cn)

**首页**

![1](/assets/inmgr/juhe-1.png)

**分类页面**

![2](/assets/inmgr/juhe-2.png)

**接口详情**

![3](/assets/inmgr/juhe-3.png)



### avatardata

URL: [avatardata](https://www.avatardata.cn)

**首页**

![1](/assets/inmgr/avatardata-1.png)

**分类**

![2](/assets/inmgr/avatardata-2.png)

**接口详情**

![3](/assets/inmgr/avatardata-3.png)



### binstd

URL: [binstd](https://www.binstd.com)

**首页**

![0](/assets/inmgr/binstd-0.png)

**分类**

自营

![1](/assets/inmgr/binstd-1.png)

商城

![2](/assets/inmgr/binstd-2.png)

**接口详情**

![3](/assets/inmgr/binstd-3.png)



### yongyou

URL: [yongyou](https://api.yonyoucloud.com/#/home)

**首页**

![1](/assets/inmgr/yongyou-1.png)

**分类**

![2](/assets/inmgr/yongyou-2.png)

**接口详情**

![3](/assets/inmgr/yongyou-3.png)

### aliyun

URL: [aliyun](https://market.aliyun.com/data)

**首页**

![1](/assets/inmgr/aliyun-1.png)

**分类**

![2](/assets/inmgr/aliyun-2.png)

**接口详情**

![3](/assets/inmgr/aliyun-3.png)



### baidu

URL: [baidu](https://cloud.baidu.com/market/home)

**首页**

![1](/assets/inmgr/baidu-1.png)

**分类**

![2](/assets/inmgr/baidu-2.png)

**接口详情**

![3](/assets/inmgr/baidu-3.png)

![4](/assets/inmgr/baidu-4.png)

![5](/assets/inmgr/baidu-5.png)

### yesapi

URL: [yesapi](http://api.yesapi.cn/docs.html)

**首页**

![1](/assets/inmgr/yesapi-1.png)

**分类**

![2](/assets/inmgr/yesapi-2.png)

**接口详情**

![3](/assets/inmgr/yesapi-3.png)

![4](/assets/inmgr/yesapi-4.png)



### mxnzp

URL: [mxnzp](https://www.mxnzp.com)

**主页/分类**

![1](/assets/inmgr/mxnzp-1.png)

**接口详情**

![2](/assets/inmgr/mxnzp-2.png)



### jisuapi

URL: [jisuapi](https://www.jisuapi.com)

**首页**

![1](/assets/inmgr/jisuapi-1.png)

**分类**

![2](/assets/inmgr/jisuapi-2.png)

**接口详情**

![3](/assets/inmgr/jisuapi-3.png)

![3](/assets/inmgr/jisuapi-4.png)



### haoservice

URL: [haoservice](http://www.haoservice.com)

**首页**

![1](/assets/inmgr/haoservice-1.png)

**分类**

![2](/assets/inmgr/haoservice-2.png)

**接口详情**

![3](/assets/inmgr/haoservice-3.png)



### jdwx

URL：[京东万象](https://wx.jdcloud.com)

**首页**

![0](/assets/inmgr/jdwx-0.png)

**分类**

![1](/assets/inmgr/jdwx-1.png)

**接口详情**

![2](/assets/inmgr/jdwx-2.png)

![2](/assets/inmgr/jdwx-3.png)

![2](/assets/inmgr/jdwx-4.png)

